<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Jewelry Inventory Tracker</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 data-translate="settings-title">⚙️ Settings</h1>
            <p data-translate="settings-subtitle">Configure your jewelry inventory tracking</p>
        </div>

        <div class="nav-links">
            <a href="/" data-translate="back-dashboard">🏠 Back to Dashboard</a>
        </div>

        <div class="form-container">
            <form action="/settings" method="POST">
                <div class="form-group">
                    <label for="businessName">Business Name *</label>
                    <input type="text" id="businessName" name="businessName" 
                           value="<%= settings.businessName %>" required>
                </div>

                <div class="form-group">
                    <label for="businessAddress">Business Address</label>
                    <textarea id="businessAddress" name="businessAddress" 
                              placeholder="Enter your business address..."><%= settings.businessAddress %></textarea>
                </div>

                <div class="form-group">
                    <label for="businessPhone">Business Phone</label>
                    <input type="tel" id="businessPhone" name="businessPhone" 
                           value="<%= settings.businessPhone %>" 
                           placeholder="(555) 123-4567">
                </div>

                <div class="form-group">
                    <label for="businessEmail">Business Email</label>
                    <input type="email" id="businessEmail" name="businessEmail" 
                           value="<%= settings.businessEmail %>" 
                           placeholder="info@yourbusiness.com">
                </div>

                <div class="form-group">
                    <label for="goldPrice" data-translate="current-gold-price">Current Gold Price (per gram) *</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.2em; font-weight: bold;">$</span>
                        <input type="number" id="goldPrice" name="goldPrice" step="0.01" min="0.01" 
                               value="<%= settings.goldPrice %>" required 
                               style="flex: 1;">
                    </div>
                    <div style="margin-top: 10px; color: #7f8c8d; font-size: 0.9em;" data-translate="gold-price-tip">
                        💡 This is used to estimate the value of your inventory items
                    </div>
                </div>

                <div class="form-group">
                    <label for="currency" data-translate="currency">Currency *</label>
                    <select id="currency" name="currency" required>
                        <option value="USD" <%= settings.currency === 'USD' ? 'selected' : '' %>>USD ($)</option>
                        <option value="EUR" <%= settings.currency === 'EUR' ? 'selected' : '' %>>EUR (€)</option>
                        <option value="GBP" <%= settings.currency === 'GBP' ? 'selected' : '' %>>GBP (£)</option>
                        <option value="CAD" <%= settings.currency === 'CAD' ? 'selected' : '' %>>CAD ($)</option>
                        <option value="AUD" <%= settings.currency === 'AUD' ? 'selected' : '' %>>AUD ($)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="taxRate">Tax Rate (%)</label>
                    <input type="number" id="taxRate" name="taxRate" step="0.1" min="0" max="50" 
                           value="<%= settings.taxRate %>" placeholder="0.0">
                </div>

                <div class="form-group">
                    <label for="defaultPurity">Default Gold Purity (%)</label>
                    <select id="defaultPurity" name="defaultPurity">
                        <option value="37.5" <%= settings.defaultPurity === 37.5 ? 'selected' : '' %>>9K (37.5%)</option>
                        <option value="41.7" <%= settings.defaultPurity === 41.7 ? 'selected' : '' %>>10K (41.7%)</option>
                        <option value="58.3" <%= settings.defaultPurity === 58.3 ? 'selected' : '' %>>14K (58.3%)</option>
                        <option value="75" <%= settings.defaultPurity === 75 ? 'selected' : '' %>>18K (75%)</option>
                        <option value="91.7" <%= settings.defaultPurity === 91.7 ? 'selected' : '' %>>22K (91.7%)</option>
                        <option value="99.9" <%= settings.defaultPurity === 99.9 ? 'selected' : '' %>>24K (99.9%)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="backupFrequency">Backup Frequency</label>
                    <select id="backupFrequency" name="backupFrequency">
                        <option value="daily" <%= settings.backupFrequency === 'daily' ? 'selected' : '' %>>Daily</option>
                        <option value="weekly" <%= settings.backupFrequency === 'weekly' ? 'selected' : '' %>>Weekly</option>
                        <option value="monthly" <%= settings.backupFrequency === 'monthly' ? 'selected' : '' %>>Monthly</option>
                    </select>
                </div>

                <div class="summary-card" style="margin: 30px 0; text-align: left;">
                    <h3>🔒 Privacy & Security</h3>
                    <div style="font-size: 1em; line-height: 1.8; margin-top: 15px;">
                        <strong>🔐 Encryption:</strong> All your data is encrypted using AES-256-GCM encryption.<br>
                        <strong>💻 Local Storage:</strong> Data is stored only on your computer, never sent to external servers.<br>
                        <strong>🔑 Machine-Specific:</strong> Encryption keys are unique to your computer.<br>
                        <strong>📁 Automatic Backups:</strong> Encrypted backups are created automatically.<br>
                        <strong>🚫 GitHub Safe:</strong> Real data is never uploaded to GitHub - only example data is shared.
                    </div>
                </div>

                <div class="summary-card" style="margin: 30px 0; text-align: left;">
                    <h3 data-translate="tips-title">💡 Tips for Using the System</h3>
                    <div style="font-size: 1em; line-height: 1.8; margin-top: 15px;">
                        <strong data-translate="current-gold-price">Gold Price:</strong> <span data-translate="gold-price-tip-text">Update this regularly to get accurate inventory valuations.</span><br>
                        <strong data-translate="adding-items-tip">Adding Items:</strong> <span data-translate="adding-items-tip">Always weigh your jewelry accurately for precise tracking.</span><br>
                        <strong data-translate="purity-tip">Purity:</strong> <span data-translate="purity-tip">Use a testing kit to determine actual gold purity.</span><br>
                        <strong data-translate="sales-tip">Sales:</strong> <span data-translate="sales-tip">Record all sales immediately to maintain accurate profit tracking.</span><br>
                        <strong data-translate="backup-tip">Backup:</strong> <span data-translate="backup-tip">Your encrypted data is automatically backed up in the 'data/backups' folder!</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="submit" class="btn primary" data-translate="save-settings">💾 Save Settings</button>
                    <a href="/" class="btn" data-translate="cancel">❌ Cancel</a>
                </div>
            </form>
        </div>

        <!-- Data Management Section -->
        <div class="form-container" style="margin-top: 30px;">
            <h3>📊 Data Management</h3>
            
            <div class="action-buttons" style="justify-content: flex-start; gap: 15px;">
                <button onclick="createBackup()" class="btn secondary">💾 Create Backup</button>
                <button onclick="exportData()" class="btn secondary">📤 Export Data</button>
                <button onclick="showWipeDataDialog()" class="btn danger">🗑️ Wipe All Data</button>
            </div>

            <div id="backup-status" style="margin-top: 20px; display: none;"></div>
        </div>
    </div>

    <!-- Wipe Data Confirmation Dialog -->
    <div id="wipe-dialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; max-width: 500px; text-align: center;">
            <h3 style="color: #e74c3c;">⚠️ WARNING: This Action Cannot Be Undone!</h3>
            <p style="margin: 20px 0; line-height: 1.6;">
                This will permanently delete ALL your inventory, sales, and settings data. 
                This action cannot be undone and will require you to start over.
            </p>
            <p style="margin: 20px 0; font-weight: bold; color: #e74c3c;">
                Type exactly: <strong>I UNDERSTAND THIS WILL DELETE ALL DATA PERMANENTLY</strong>
            </p>
            <input type="text" id="wipe-confirmation" placeholder="Type the confirmation text..." 
                   style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; margin: 20px 0;">
            <div style="margin-top: 20px;">
                <button onclick="wipeAllData()" class="btn danger" id="wipe-button" disabled>🗑️ Wipe All Data</button>
                <button onclick="hideWipeDataDialog()" class="btn">❌ Cancel</button>
            </div>
        </div>
    </div>

    <script src="/js/language.js"></script>
    <script>
        // Enable/disable wipe button based on confirmation text
        document.getElementById('wipe-confirmation').addEventListener('input', function() {
            const confirmationText = "I UNDERSTAND THIS WILL DELETE ALL DATA PERMANENTLY";
            const wipeButton = document.getElementById('wipe-button');
            wipeButton.disabled = this.value !== confirmationText;
        });

        function showWipeDataDialog() {
            document.getElementById('wipe-dialog').style.display = 'block';
        }

        function hideWipeDataDialog() {
            document.getElementById('wipe-dialog').style.display = 'none';
            document.getElementById('wipe-confirmation').value = '';
            document.getElementById('wipe-button').disabled = true;
        }

        function createBackup() {
            fetch('/api/backup')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('backup-status').innerHTML = 
                            '<div class="message success">✅ Backup created successfully!</div>';
                        document.getElementById('backup-status').style.display = 'block';
                        setTimeout(() => {
                            document.getElementById('backup-status').style.display = 'none';
                        }, 3000);
                    }
                })
                .catch(error => {
                    document.getElementById('backup-status').innerHTML = 
                        '<div class="message error">❌ Error creating backup</div>';
                    document.getElementById('backup-status').style.display = 'block';
                });
        }

        function exportData() {
            window.location.href = '/api/export';
        }

        function wipeAllData() {
            const confirmation = document.getElementById('wipe-confirmation').value;
            
            fetch('/api/wipe-data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ confirm: confirmation })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('All data has been permanently deleted. The page will reload.');
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error wiping data: ' + error);
            });
        }

        document.querySelector('form').addEventListener('submit', function(e) {
            const goldPrice = parseFloat(document.getElementById('goldPrice').value);
            if (goldPrice <= 0) {
                const errorMessage = LanguageManager.currentLanguage === 'es' 
                    ? LanguageManager.translations.es['invalid-gold-price']
                    : LanguageManager.translations.en['invalid-gold-price'];
                alert(errorMessage);
                e.preventDefault();
                return;
            }
            
            const confirmMessage = LanguageManager.currentLanguage === 'es' 
                ? LanguageManager.translations.es['settings-confirm']
                : LanguageManager.translations.en['settings-confirm'];
                
            if (confirm(confirmMessage)) {
                return true;
            } else {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
