<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate="page-title-settings">
      Settings - Jewelry Inventory Tracker
    </title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 data-translate="settings-title">Settings</h1>
      </div>

      <div class="nav-links">
        <a href="/" data-translate="nav-dashboard">🏠 Dashboard</a>
      </div>

      <!-- Settings Layout Container -->
      <div
        style="
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 30px;
          margin-top: 30px;
        "
      >
        <!-- Left Column: Live Gold Price -->
        <div
          class="summary-card"
          style="margin: 0; text-align: center; height: fit-content"
        >
          <h3 data-translate="live-gold-price">💰 Live Gold Price</h3>
          <div style="font-size: 1.1em; line-height: 1.6; margin-top: 15px">
            <div style="margin-bottom: 15px">
              <div
                style="
                  font-size: 1.8em;
                  font-weight: bold;
                  color: #2c3e50;
                  margin-bottom: 3px;
                "
              >
                $<%= (settings && settings.goldPricePerOunce ?
                settings.goldPricePerOunce : 3314.92).toFixed(2) %>
              </div>
              <div style="color: #7f8c8d; font-size: 0.9em">
                <span data-translate="per-ounce">per troy ounce</span>
              </div>
            </div>

            <div
              style="
                margin-bottom: 15px;
                padding: 12px;
                background: #f8f9fa;
                border-radius: 8px;
              "
            >
              <div
                style="font-weight: bold; color: #34495e; margin-bottom: 5px"
              >
                <span data-translate="per-gram">Per Gram (24K)</span>
              </div>
              <div style="font-size: 1.2em; color: #27ae60">
                $<%= ((settings && settings.goldPricePerOunce ?
                settings.goldPricePerOunce : 3314.92) / 31.1034768).toFixed(2)
                %>
              </div>
            </div>

            <div style="padding: 12px; background: #ecf0f1; border-radius: 8px">
              <div
                style="font-weight: bold; color: #34495e; margin-bottom: 3px"
              >
                <span data-translate="updated">Last Updated</span>
              </div>
              <div style="color: #7f8c8d">
                <%= settings && settings.lastUpdated ? new
                Date(settings.lastUpdated).toLocaleString() : new
                Date().toLocaleString() %>
              </div>
            </div>
          </div>

          <div id="price-status" style="margin-top: 15px; display: none"></div>
        </div>

        <!-- Right Column: Data Management -->
        <div
          class="summary-card"
          style="margin: 0; text-align: center; height: fit-content"
        >
          <h3 data-translate="data-management">🔧 Data Management</h3>

          <div style="margin-top: 25px">
            <button
              onclick="createBackup()"
              class="btn secondary"
              style="
                width: 100%;
                margin-bottom: 15px;
                padding: 15px;
                font-size: 1.1em;
              "
              data-translate="create-backup"
            >
              💾 Create Backup
            </button>

            <button
              onclick="showWipeDataDialog()"
              class="btn danger"
              style="width: 100%; padding: 15px; font-size: 1.1em"
              data-translate="wipe-all-data"
            >
              🗑️ Wipe All Data
            </button>
          </div>

          <div id="backup-status" style="margin-top: 20px; display: none"></div>

          <div
            style="
              margin-top: 25px;
              padding: 20px;
              background: #fff3cd;
              border: 1px solid #ffeaa7;
              border-radius: 8px;
            "
          >
            <div style="color: #856404; font-size: 0.9em; line-height: 1.5">
              <strong>💡 Tip:</strong> Regular backups ensure your data is safe.
              Backups are stored in the <code>data/backups/</code>folder.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Wipe Data Confirmation Dialog -->
    <div
      id="wipe-dialog"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 30px;
          border-radius: 10px;
          max-width: 500px;
          text-align: center;
        "
      >
        <h3 style="color: #e74c3c">
          ⚠️ WARNING: This Action Cannot Be Undone!
        </h3>
        <p style="margin: 20px 0; line-height: 1.6">
          This will permanently delete ALL your inventory, sales, and settings
          data. This action cannot be undone and will require you to start over.
        </p>
        <p style="margin: 20px 0; font-weight: bold; color: #e74c3c">
          Type exactly:
          <strong>DELETE ALL DATA</strong>
        </p>
        <input
          type="text"
          id="wipe-confirmation"
          placeholder="Type: DELETE ALL DATA"
          style="
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 20px 0;
          "
        />
        <div style="display: flex; gap: 15px; justify-content: center">
          <button
            onclick="confirmWipeData()"
            class="btn danger"
            style="min-width: 120px"
          >
            Confirm Delete
          </button>
          <button
            onclick="hideWipeDataDialog()"
            class="btn"
            style="min-width: 120px"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Credit Line -->
    <div
      style="
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        border-top: 1px solid #eee;
      "
    >
      <small style="color: #888; font-size: 12px">
        Website system created by Cristian Hernandez
      </small>
    </div>

    <script src="/js/language.js"></script>
    <script>
      function createBackup() {
        const statusDiv = document.getElementById("backup-status");
        statusDiv.innerHTML =
          '<div class="message">🔄 Creating backup...</div>';
        statusDiv.style.display = "block";

        fetch("/api/backup", {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              statusDiv.innerHTML = `<div class="message success">✅ Backup created successfully!<br>File: ${data.filename}</div>`;
            } else {
              statusDiv.innerHTML = `<div class="message error">❌ Error: ${data.error}</div>`;
            }
          })
          .catch((error) => {
            statusDiv.innerHTML = `<div class="message error">❌ Network error: ${error.message}</div>`;
          });
      }

      function showWipeDataDialog() {
        document.getElementById("wipe-dialog").style.display = "block";
      }

      function hideWipeDataDialog() {
        document.getElementById("wipe-dialog").style.display = "none";
        document.getElementById("wipe-confirmation").value = "";
      }

      function confirmWipeData() {
        const confirmation = document.getElementById("wipe-confirmation").value;
        const expectedText = "DELETE ALL DATA";

        if (confirmation === expectedText) {
          fetch("/api/wipe-data", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ confirm: expectedText }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("All data has been wiped. Redirecting to dashboard...");
                window.location.href = "/";
              } else {
                alert("Error wiping data: " + data.error);
              }
            })
            .catch((error) => {
              alert("Network error: " + error.message);
            });
        } else {
          alert(
            "Confirmation text does not match. Please type exactly: " +
              expectedText
          );
        }
      }
    </script>
  </body>
</html>
