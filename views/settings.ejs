<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate="page-title-settings">
      Settings - Jewelry Inventory Tracker
    </title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 data-translate="settings-title">Settings</h1>
      </div>

      <div class="nav-links">
        <a href="/" data-translate="nav-dashboard">üè† Dashboard</a>
      </div>



          <div class="summary-card" style="margin: 30px 0; text-align: left">
            <h3 data-translate="live-gold-price">Live Gold Price</h3>
            <div style="font-size: 1em; line-height: 1.8; margin-top: 15px">
              <strong data-translate="current">Current:</strong> $<%= (settings
              && settings.goldPricePerOunce ? settings.goldPricePerOunce :
              3314.92).toFixed(2) %>
              <span data-translate="per-ounce">per ounce</span><br />
              <strong data-translate="per-gram">Per Gram:</strong> $<%=
              ((settings && settings.goldPricePerOunce ?
              settings.goldPricePerOunce : 3314.92) / 31.1035).toFixed(2) %><br />
              <strong data-translate="updated">Updated:</strong> <%= settings &&
              settings.lastUpdated ? new
              Date(settings.lastUpdated).toLocaleString() : new
              Date().toLocaleString() %>
            </div>

            <div
              id="price-status"
              style="margin-top: 15px; display: none"
            ></div>
          </div>

          <div class="summary-card" style="margin: 30px 0; text-align: left">
            <h3 data-translate="gold-purity-standards">
              Gold Purity Standards
            </h3>
            <div style="font-size: 0.9em; line-height: 1.6; margin-top: 15px">
              <table
                style="width: 100%; border-collapse: collapse; margin-top: 15px"
              >
                <thead>
                  <tr
                    style="
                      background-color: #f8f9fa;
                      border-bottom: 2px solid #dee2e6;
                    "
                  >
                    <th
                      style="
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #dee2e6;
                      "
                    >
                      Karat
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #dee2e6;
                      "
                    >
                      Purity %
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #dee2e6;
                      "
                    >
                      Dealer Pays
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #dee2e6;
                      "
                    >
                      1g Value
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <% Object.keys(goldPurity).forEach(function(karat) { %>
                  <tr style="border-bottom: 1px solid #dee2e6">
                    <td
                      style="
                        padding: 12px;
                        border: 1px solid #dee2e6;
                        font-weight: bold;
                      "
                    >
                      <%= karat %>
                    </td>
                    <td style="padding: 12px; border: 1px solid #dee2e6">
                      <%= goldPurity[karat] %>%
                    </td>
                    <td style="padding: 12px; border: 1px solid #dee2e6">
                      <%= (dealerMarkup[karat] * 100).toFixed(0) %>%
                    </td>
                    <td style="padding: 12px; border: 1px solid #dee2e6">
                      $<%= (((settings && settings.goldPricePerOunce ?
                      settings.goldPricePerOunce : 3314.92) / 31.1035) *
                      (goldPurity[karat] / 100) *
                      dealerMarkup[karat]).toFixed(2) %>
                    </td>
                  </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>


        </form>
      </div>

      <!-- Data Management Section -->
      <div class="form-container" style="margin-top: 30px">
        <h3 data-translate="data-management">Data Management</h3>

        <div
          class="action-buttons"
          style="justify-content: flex-start; gap: 15px"
        >
          <button
            onclick="createBackup()"
            class="btn secondary"
            data-translate="create-backup"
          >
            Create Backup
          </button>
          <button
            onclick="showWipeDataDialog()"
            class="btn danger"
            data-translate="wipe-all-data"
          >
            Wipe All Data
          </button>
        </div>

        <div id="backup-status" style="margin-top: 20px; display: none"></div>
      </div>
    </div>

    <!-- Wipe Data Confirmation Dialog -->
    <div
      id="wipe-dialog"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 30px;
          border-radius: 10px;
          max-width: 500px;
          text-align: center;
        "
      >
        <h3 style="color: #e74c3c">
          ‚ö†Ô∏è WARNING: This Action Cannot Be Undone!
        </h3>
        <p style="margin: 20px 0; line-height: 1.6">
          This will permanently delete ALL your inventory, sales, and settings
          data. This action cannot be undone and will require you to start over.
        </p>
        <p style="margin: 20px 0; font-weight: bold; color: #e74c3c">
          Type exactly:
          <strong>DELETE ALL DATA</strong>
        </p>
        <input
          type="text"
          id="wipe-confirmation"
          placeholder="Type: DELETE ALL DATA"
          style="
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 20px 0;
          "
        />
        <div style="display: flex; gap: 15px; justify-content: center">
          <button
            onclick="confirmWipeData()"
            class="btn danger"
            style="min-width: 120px"
          >
            Confirm Delete
          </button>
          <button
            onclick="hideWipeDataDialog()"
            class="btn"
            style="min-width: 120px"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <script src="/js/language.js"></script>
    <script>


      function createBackup() {
        const statusDiv = document.getElementById("backup-status");
        statusDiv.innerHTML =
          '<div class="message">üîÑ Creating backup...</div>';
        statusDiv.style.display = "block";

        fetch("/api/backup", {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              statusDiv.innerHTML = `<div class="message success">‚úÖ Backup created successfully!<br>File: ${data.filename}</div>`;
            } else {
              statusDiv.innerHTML = `<div class="message error">‚ùå Error: ${data.error}</div>`;
            }
          })
          .catch((error) => {
            statusDiv.innerHTML = `<div class="message error">‚ùå Network error: ${error.message}</div>`;
          });
      }



      function showWipeDataDialog() {
        document.getElementById("wipe-dialog").style.display = "block";
      }

      function hideWipeDataDialog() {
        document.getElementById("wipe-dialog").style.display = "none";
        document.getElementById("wipe-confirmation").value = "";
      }

      function confirmWipeData() {
        const confirmation = document.getElementById("wipe-confirmation").value;
        const expectedText = "DELETE ALL DATA";

        if (confirmation === expectedText) {
          fetch("/api/wipe-data", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ confirm: expectedText }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("All data has been wiped. Redirecting to dashboard...");
                window.location.href = "/";
              } else {
                alert("Error wiping data: " + data.error);
              }
            })
            .catch((error) => {
              alert("Network error: " + error.message);
            });
        } else {
          alert(
            "Confirmation text does not match. Please type exactly: " +
              expectedText
          );
        }
      }
    </script>
  </body>
</html>
