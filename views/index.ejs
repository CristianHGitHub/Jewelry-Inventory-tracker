<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gold Jewelry Inventory Tracker</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 data-translate="header-title">💎 Gold Jewelry Inventory</h1>
        <p data-translate="header-subtitle">
          Simple tracking for your jewelry business
        </p>
      </div>

      <div class="summary-cards">
        <div class="summary-card">
          <h3 data-translate="inventory-value">📦 Inventory Value</h3>
          <div class="amount">$<%= totalInventoryValue.toFixed(2) %></div>
        </div>
        <div class="summary-card sales">
          <h3 data-translate="total-sales">💰 Total Sales</h3>
          <div class="amount">$<%= totalSales.toFixed(2) %></div>
        </div>
        <div class="summary-card profit">
          <h3 data-translate="total-profit">📈 Total Profit</h3>
          <div class="amount">$<%= totalProfit.toFixed(2) %></div>
        </div>
      </div>

      <div class="action-buttons">
        <a href="/add-item" class="btn primary" data-translate="add-new-item"
          >➕ Add New Item</a
        >
        <a href="/settings" class="btn secondary" data-translate="settings"
          >⚙️ Settings</a
        >
      </div>

      <% if (inventory.length > 0) { %>
      <div class="table-container">
        <div class="table-header">
          <h2 data-translate="current-inventory">📋 Current Inventory</h2>
        </div>
        <table>
          <thead>
            <tr>
              <th data-translate="name">Name</th>
              <th data-translate="type">Type</th>
              <th data-translate="weight">Weight (g)</th>
              <th data-translate="purity">Purity</th>
              <th data-translate="cost">Cost</th>
              <th data-translate="est-value">Est. Value</th>
              <th data-translate="date-added">Date Added</th>
              <th data-translate="actions">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% inventory.forEach(item => { %>
            <tr>
              <td><strong><%= item.name %></strong></td>
              <td><%= item.type %></td>
              <td><%= item.weight %>g</td>
              <td><%= item.purity %>%</td>
              <td>$<%= item.cost.toFixed(2) %></td>
              <td>$<%= (item.weight * settings.goldPrice).toFixed(2) %></td>
              <td><%= new Date(item.dateAdded).toLocaleDateString() %></td>
              <td class="table-actions">
                <a
                  href="/sell-item/<%= item.id %>"
                  class="btn primary small"
                  data-translate="sell"
                  >💰 Sell</a
                >
                <button
                  onclick="deleteItem('<%= item.id %>')"
                  class="btn danger small"
                  data-translate="delete"
                >
                  🗑️ Delete
                </button>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <% } else { %>
      <div class="empty-state">
        <h3 data-translate="no-items">📦 No Items in Inventory</h3>
        <p data-translate="start-adding">
          Start by adding your first jewelry item to track your inventory!
        </p>
        <a href="/add-item" class="btn primary" data-translate="add-first-item"
          >➕ Add Your First Item</a
        >
      </div>
      <% } %> <% if (sales.length > 0) { %>
      <div class="table-container">
        <div class="table-header">
          <h2 data-translate="recent-sales">💵 Recent Sales</h2>
        </div>
        <table>
          <thead>
            <tr>
              <th data-translate="name">Item Name</th>
              <th data-translate="type">Type</th>
              <th data-translate="weight">Weight (g)</th>
              <th data-translate="cost">Cost</th>
              <th data-translate="sale-price">Sale Price</th>
              <th data-translate="profit">Profit</th>
              <th data-translate="buyer">Buyer</th>
              <th data-translate="date-sold">Date Sold</th>
            </tr>
          </thead>
          <tbody>
            <% sales.slice(-10).reverse().forEach(sale => { %>
            <tr>
              <td><strong><%= sale.itemName %></strong></td>
              <td><%= sale.itemType %></td>
              <td><%= sale.weight %>g</td>
              <td>$<%= sale.cost.toFixed(2) %></td>
              <td>$<%= sale.price.toFixed(2) %></td>
              <td
                class="<%= sale.profit >= 0 ? 'profit-positive' : 'profit-negative' %>"
              >
                $<%= sale.profit.toFixed(2) %>
              </td>
              <td><%= sale.buyer || 'N/A' %></td>
              <td><%= new Date(sale.dateSold).toLocaleDateString() %></td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <% } %>
    </div>

    <script src="/js/language.js"></script>
    <script>
      function deleteItem(itemId) {
        const confirmMessage =
          LanguageManager.currentLanguage === "es"
            ? LanguageManager.translations.es["delete-confirm"]
            : LanguageManager.translations.en["delete-confirm"];

        if (confirm(confirmMessage)) {
          fetch(`/item/${itemId}`, {
            method: "DELETE",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                location.reload();
              } else {
                const errorMessage =
                  LanguageManager.currentLanguage === "es"
                    ? LanguageManager.translations.es["error-deleting"]
                    : LanguageManager.translations.en["error-deleting"];
                alert(errorMessage);
              }
            })
            .catch((error) => {
              const errorMessage =
                LanguageManager.currentLanguage === "es"
                  ? LanguageManager.translations.es["error-deleting"]
                  : LanguageManager.translations.en["error-deleting"];
              alert(errorMessage);
            });
        }
      }
    </script>
  </body>
</html>
