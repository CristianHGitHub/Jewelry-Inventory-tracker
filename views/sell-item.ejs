<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sell Jewelry Item</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 data-translate="sell-item">üí∞ Sell Item</h1>
        <p data-translate="sell-item-subtitle">
          Record the sale of your jewelry item
        </p>
      </div>

      <div class="nav-links">
        <a href="/" data-translate="back-dashboard">üè† Back to Dashboard</a>
      </div>

      <div class="form-container">
        <div class="summary-card" style="margin-bottom: 30px">
          <h3 data-translate="item-details">üìã Item Details</h3>
          <div style="text-align: left; font-size: 1.1em; margin-top: 15px">
            <strong data-translate="name">Name:</strong> <%= item.name %><br />
            <strong data-translate="type">Type:</strong> <%= item.type %><br />
            <strong data-translate="weight">Weight:</strong> <%= item.weight
            %>g<br />
            <strong data-translate="purity">Purity:</strong> <%= item.purity
            %>%<br />
            <strong data-translate="original-cost">Original Cost:</strong> $<%=
            item.cost.toFixed(2) %><br />
            <% if (item.description) { %>
            <strong data-translate="description">Description:</strong> <%=
            item.description %><br />
            <% } %>
          </div>
        </div>

        <form action="/sell-item/<%= item.id %>" method="POST">
          <div class="form-group">
            <label for="price" data-translate="sale-price-label"
              >Sale Price ($) *</label
            >
            <input
              type="number"
              id="price"
              name="price"
              step="0.01"
              min="0"
              data-translate-placeholder="sale-price-placeholder"
              placeholder="0.00"
              required
            />
            <div
              id="profit-display"
              style="margin-top: 10px; font-weight: bold; font-size: 1.1em"
            ></div>
          </div>

          <div class="form-group">
            <label for="buyer" data-translate="buyer-name"
              >Buyer Name (optional)</label
            >
            <input
              type="text"
              id="buyer"
              name="buyer"
              data-translate-placeholder="buyer-placeholder"
              placeholder="Customer name or business"
            />
          </div>

          <div class="form-group">
            <label for="notes" data-translate="sale-notes"
              >Sale Notes (optional)</label
            >
            <textarea
              id="notes"
              name="notes"
              data-translate-placeholder="notes-placeholder"
              placeholder="Any additional notes about the sale..."
            ></textarea>
          </div>

          <div class="action-buttons">
            <button
              type="submit"
              class="btn primary"
              data-translate="complete-sale"
            >
              üí∞ Complete Sale
            </button>
            <a href="/" class="btn" data-translate="cancel">‚ùå Cancel</a>
          </div>
        </form>
      </div>
    </div>

    <script src="/js/language.js"></script>
    <script>
      const costPrice = <%= item.cost %>;

      document.getElementById('price').addEventListener('input', function() {
          const salePrice = parseFloat(this.value) || 0;
          const profit = salePrice - costPrice;
          const profitDisplay = document.getElementById('profit-display');

          if (salePrice > 0) {
              const profitClass = profit >= 0 ? 'profit-positive' : 'profit-negative';
              const profitText = profit >= 0 ? 'Profit' : 'Loss';
              profitDisplay.innerHTML = `${profitText}: <span class="${profitClass}">$${Math.abs(profit).toFixed(2)}</span>`;
          } else {
              profitDisplay.innerHTML = '';
          }
      });

      // Confirm before selling
      document.querySelector('form').addEventListener('submit', function(e) {
          const salePrice = parseFloat(document.getElementById('price').value) || 0;
          const profit = salePrice - costPrice;

          // Get translated messages
          const profitText = profit >= 0
              ? LanguageManager.translations[LanguageManager.currentLanguage]['profit'].replace('${amount}', Math.abs(profit).toFixed(2))
              : LanguageManager.translations[LanguageManager.currentLanguage]['loss'].replace('${amount}', Math.abs(profit).toFixed(2));

          const confirmMessage = LanguageManager.translations[LanguageManager.currentLanguage]['sale-confirm']
              .replace('{itemName}', '<%= item.name %>')
              .replace('${price}', salePrice.toFixed(2))
              .replace('{profitText}', profitText);

          if (!confirm(confirmMessage)) {
              e.preventDefault();
          }
      });
    </script>
  </body>
</html>
